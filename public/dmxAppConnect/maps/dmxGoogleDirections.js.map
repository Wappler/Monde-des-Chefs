{"version":3,"sources":["components/googleDirections.js","components/googleDistanceMatrix.js"],"names":["dmx","Component","initialData","routeIndex","routes","status","attributes","map","type","String","default","origin","Object","destination","waypoints","Array","travel-mode","unit-system","departure-time","Date","arrival-time","transit-modes","transit-preference","show-directions","Boolean","provide-alternatives","avoid-ferries","avoid-highways","avoid-tolls","optimize-waypoints","draggable","dynamic-update","methods","route","this","setRouteIndex","index","directions","set","renderer","events","directionschanged","Event","routeindexchanged","noresults","success","error","render","node","target","document","getElementById","props","dmxComponent","service","google","maps","DirectionsService","DirectionsRenderer","addListener","directionsChanged","bind","routeindexChanged","update","setOptions","JSON","stringify","isArray","latitude","longitude","lat","lng","request","getWaypoints","optimizeWaypoints","travelMode","TravelMode","unitSystem","UnitSystem","provideRouteAlternatives","avoidFerries","avoidHighways","avoidTolls","transitOptions","arrivalTime","departureTime","modes","routingPreference","drivingOptions","updateRoute","catch","split","waypoint","location","getRouteIndex","requestAnimationFrame","dispatchEvent","getDirections","copyrights","summary","fare","currency","value","face","totalMeters","legs","reduce","d","leg","distance","totalSeconds","duration","waypointsOrder","waypoint_order","arrivalDate","arrival_time","toISOString","departureDate","departure_time","arrival","text","departure","meters","seconds","start","start_address","end","end_address","steps","step","transit","stop","arrival_stop","name","date","time","departure_stop","headsign","numStops","num_stops","line","instructions","maneuver","travel_mode","setTimeout","setMap","setDirections","setPanel","$node","results","origins","destinations","units","getDistance","DistanceMatrixService","getDistanceMatrix","onResponse","response","originAddresses","destinationAddresses","i","length","elements","rows","j","element","push"],"mappings":"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","file":"../dmxGoogleDirections/dmxGoogleDirections.js","sourcesContent":["dmx.Component('google-directions', {\r\n\r\n    initialData: {\r\n        routeIndex: 0,\r\n        routes: [],\r\n        status: ''\r\n    },\r\n\r\n    attributes: {\r\n        map: { // required\r\n            type: String,\r\n            default: null\r\n        },\r\n\r\n        origin: { // required\r\n            type: [Object, String],\r\n            default: null\r\n        },\r\n\r\n        destination: { // required\r\n            type: [Object, String],\r\n            default: null\r\n        },\r\n\r\n        waypoints: {\r\n            type: [Array, String], // array or | separated string\r\n            default: null\r\n        },\r\n\r\n        'travel-mode': {\r\n            type: String,\r\n            default: 'DRIVING' // DRIVING, WALKING, BICYCLING, TRANSIT\r\n        },\r\n\r\n        'unit-system': {\r\n            type: String,\r\n            default: 'METRIC' // METRIC, IMPERIAL\r\n        },\r\n\r\n        'departure-time': {\r\n            type: Date,\r\n            default: null\r\n        },\r\n\r\n        'arrival-time': {\r\n            type: Date,\r\n            default: null\r\n        },\r\n\r\n        'transit-modes': {\r\n            type: Array,\r\n            default: null // BUS, RAIL, SUBWAY, TRAIN, TRAM\r\n        },\r\n\r\n        'transit-preference': {\r\n            type: String,\r\n            default: null // FEWER_TRANSFERS, LESS_WALKING\r\n        },\r\n\r\n        'show-directions': {\r\n            type: Boolean,\r\n            default: false\r\n        },\r\n\r\n        'provide-alternatives': {\r\n            type: Boolean,\r\n            default: false\r\n        },\r\n\r\n        'avoid-ferries': {\r\n            type: Boolean,\r\n            default: false\r\n        },\r\n\r\n        'avoid-highways': {\r\n            type: Boolean,\r\n            default: false\r\n        },\r\n\r\n        'avoid-tolls': {\r\n            type: Boolean,\r\n            default: false\r\n        },\r\n\r\n        'optimize-waypoints': {\r\n            type: Boolean,\r\n            default: false\r\n        },\r\n\r\n        draggable: {\r\n            type: Boolean,\r\n            default: false\r\n        },\r\n\r\n        'dynamic-update': {\r\n            type: Boolean,\r\n            default: false\r\n        }\r\n    },\r\n\r\n    methods: {\r\n        route: function() {\r\n            this.route();\r\n        },\r\n\r\n        setRouteIndex: function(index) {\r\n            if (this.directions) {\r\n                this.set('routeIndex', index);\r\n                this.renderer.setRouteIndex(index);\r\n            }\r\n        }\r\n    },\r\n\r\n    events: {\r\n        directionschanged: Event,\r\n        routeindexchanged: Event,\r\n        noresults: Event,\r\n        success: Event,\r\n        error: Event\r\n    },\r\n\r\n    render: function(node) {\r\n        this.target = document.getElementById(this.props.map);\r\n        this.map = this.target && this.target.dmxComponent && this.target.dmxComponent.map;\r\n\r\n        this.service = new google.maps.DirectionsService();\r\n        this.renderer = new google.maps.DirectionsRenderer({\r\n            draggable: this.props.draggable\r\n        });\r\n\r\n        this.renderer.addListener('directions_changed', this.directionsChanged.bind(this));\r\n        this.renderer.addListener('routeindex_changed', this.routeindexChanged.bind(this));\r\n\r\n        this.route();\r\n    },\r\n\r\n    update: function(props) {\r\n        if (this.props.map && !this.map) {\r\n            this.map = this.target && this.target.dmxComponent && this.target.dmxComponent.map;\r\n        }\r\n\r\n        if (this.props.draggable != props.draggable) {\r\n            this.renderer.setOptions({ draggable: this.props.draggable });\r\n        }\r\n\r\n        if (this.props['dynamic-update']) {\r\n            if (\r\n                JSON.stringify(this.props.origin) != JSON.stringify(props.origin) ||\r\n                JSON.stringify(this.props.destination) != JSON.stringify(props.destination) ||\r\n                JSON.stringify(this.props.waypoints) != JSON.stringify(props.waypoints)\r\n            ) {\r\n                this.route();\r\n            }\r\n        }\r\n    },\r\n\r\n    route: function() {\r\n        if (!this.props.origin || !this.props.destination) return;\r\n\r\n        var origin = this.props.origin;\r\n        var destination = this.props.destination;\r\n\r\n        if (Array.isArray(origin)) {\r\n            origin = origin[0];\r\n        }\r\n\r\n        if (Array.isArray(destination)) {\r\n            destination = destination[0];\r\n        }\r\n\r\n        if (this.props.origin.latitude && this.props.origin.longitude) {\r\n          origin = { lat: +this.props.origin.latitude, lng: +this.props.origin.longitude };\r\n        } else if (origin.lat && origin.lng) {\r\n            // make sure it are numbers\r\n            origin.lat = +origin.lat;\r\n            origin.lng = +origin.lng;\r\n        }\r\n\r\n        if (this.props.destination.latitude && this.props.destination.longitude) {\r\n          destination = { lat: +this.props.destination.latitude, lng: +this.props.destination.longitude };\r\n        } else if (destination.lat && destination.lng) {\r\n            // make sure it are numbers\r\n            destination.lat = +destination.lat;\r\n            destination.lng = +destination.lng;\r\n        }\r\n\r\n        var request = {\r\n            origin: origin,\r\n            destination: destination,\r\n            waypoints: this.getWaypoints(),\r\n            optimizeWaypoints: this.props['optimize-waypoints'],\r\n            travelMode: google.maps.TravelMode[this.props['travel-mode']],\r\n            unitSystem: google.maps.UnitSystem[this.props['unit-system']],\r\n            provideRouteAlternatives: this.props['provide-alternatives'],\r\n            avoidFerries: this.props['avoid-ferries'],\r\n            avoidHighways: this.props['avoid-highways'],\r\n            avoidTolls: this.props['avoid-tolls']\r\n        };\r\n\r\n        if (this.props['travel-mode'] == 'TRANSIT') {\r\n            request.transitOptions = {};\r\n\r\n            if (this.props['arrival-time']) {\r\n                request.transitOptions.arrivalTime = new Date(this.props['arrival-time']);\r\n            }\r\n\r\n            if (this.props['departure-time']) {\r\n                request.transitOptions.departureTime = new Date(this.props['departure-time']);\r\n            }\r\n\r\n            if (Array.isArray(this.props['transit-modes'])) {\r\n                request.transitOptions.modes = this.props['transit-modes'];\r\n            }\r\n\r\n            if (this.props['transit-preference']) {\r\n                request.transitOptions.routingPreference = this.props['transit-preference'];\r\n            }\r\n        }\r\n\r\n        if (this.props['travel-mode'] == 'DRIVING' && this.props['departure-time']) {\r\n            request.drivingOptions = {};\r\n\r\n            if (this.props['departure-time']) {\r\n                request.drivingOptions.departureTime = new Date(this.props['departure-time']);\r\n            }\r\n        }\r\n\r\n        this.service.route(request, this.updateRoute.bind(this)).catch(function(error) {\r\n            // do nothing, just preventing uncought error\r\n        });\r\n    },\r\n\r\n    getWaypoints: function() {\r\n        if (typeof this.props.waypoints == 'string') {\r\n            this.props.waypoints = this.props.waypoints.split(/\\s*\\|\\s*/);\r\n        }\r\n\r\n        if (Array.isArray(this.props.waypoints)) {\r\n            return this.props.waypoints.map(function(waypoint) {\r\n                if (waypoint.lat) waypoint.lat = +waypoint.lat;\r\n                if (waypoint.lng) waypoint.lng = +waypoint.lng;\r\n                return { location: waypoint };\r\n            });\r\n        }\r\n\r\n        return null;\r\n    },\r\n\r\n    routeindexChanged: function() {\r\n        this.set('routeIndex', this.renderer.getRouteIndex());\r\n        requestAnimationFrame(this.dispatchEvent.bind(this, 'routeindexchanged'));\r\n    },\r\n\r\n    directionsChanged: function() {\r\n        var directions = this.renderer.getDirections();\r\n\r\n        this.set('routes', directions.routes.map(function(route, index) {\r\n            return {\r\n                index: index,\r\n                copyrights: route.copyrights,\r\n                summary: route.summary,\r\n                fare: route.fare ? {\r\n                    currency: route.fare.currency,\r\n                    value: route.face.value\r\n                } : null,\r\n                totalMeters: route.legs.reduce(function(d, leg) {\r\n                    d += (leg.distance && leg.distance.value || 0);\r\n                    return d;\r\n                }, 0),\r\n                totalSeconds: route.legs.reduce(function(d, leg) {\r\n                    d += (leg.duration && leg.duration.value || 0);\r\n                    return d;\r\n                }, 0),\r\n                waypointsOrder: route.waypoint_order,\r\n                legs: route.legs.map(function(leg) {\r\n                    return {\r\n                        arrivalDate: leg.arrival_time && leg.arrival_time.value.toISOString(),\r\n                        departureDate: leg.departure_time && leg.departure_time.value.toISOString(),\r\n                        arrival: leg.arrival_time && leg.arrival_time.text,\r\n                        departure: leg.departure_time && leg.departure_time.text,\r\n                        distance: leg.distance.text,\r\n                        duration: leg.duration.text,\r\n                        meters: leg.distance.value,\r\n                        seconds: leg.duration.value,\r\n                        start: leg.start_address,\r\n                        end: leg.end_address,\r\n                        steps: leg.steps.map(function(step) {\r\n                            var transit = {};\r\n\r\n                            if (step.transit) {\r\n                                transit.arrival = {\r\n                                  stop: step.transit.arrival_stop.name,\r\n                                  date: step.transit.arrival_time.value.toISOString(),\r\n                                  time: step.transit.arrival_time.text\r\n                                };\r\n                                transit.departure = {\r\n                                  stop: step.transit.departure_stop.name,\r\n                                  date: step.transit.departure_time.value.toISOString(),\r\n                                  time: step.transit.departure_time.text\r\n                                };\r\n                                transit.headsign = step.transit.headsign;\r\n                                transit.numStops = step.transit.num_stops;\r\n                                transit.line = step.transit.line;\r\n                            }\r\n\r\n                            return {\r\n                                distance: step.distance.text,\r\n                                duration: step.duration.text,\r\n                                instructions: step.instructions,\r\n                                maneuver: step.maneuver,\r\n                                travelMode: step.travel_mode,\r\n                                transit: transit\r\n                            };\r\n                        })\r\n                    };\r\n                })\r\n            }\r\n        }));\r\n\r\n        setTimeout(this.dispatchEvent.bind(this, 'directionschanged'), 100);\r\n    },\r\n\r\n    updateRoute: function(directions, status) {\r\n        this.set('routeIndex', 0);\r\n        this.set('status', status);\r\n\r\n        if (status == 'OK') {\r\n            this.directions = directions;\r\n            if (this.props.map && this.map) {\r\n                this.renderer.setMap(this.map);\r\n            } else {\r\n                this.renderer.setMap(null)\r\n            }\r\n            this.renderer.setDirections(directions);\r\n\r\n            if (this.props['show-directions']) {\r\n                this.renderer.setPanel(this.$node);\r\n            }\r\n\r\n            requestAnimationFrame(this.dispatchEvent.bind(this, 'success'))\r\n        } else {\r\n            //console.warn(directions, status);\r\n            this.directions = null;\r\n            this.set('routes', []);\r\n            if (status == 'ZERO_RESULTS') {\r\n                requestAnimationFrame(this.dispatchEvent.bind(this, 'noresults'));\r\n            } else {\r\n                requestAnimationFrame(this.dispatchEvent.bind(this, 'error'));\r\n            }\r\n        }\r\n    }\r\n\r\n});\r\n","dmx.Component('google-distance-matrix', {\r\n\r\n    /*\r\n        result object\r\n        {\r\n            origin: String,\r\n            destination: String,\r\n            distance: String,\r\n            duration: String,\r\n            meters: Number,\r\n            seconds: Number\r\n        }\r\n    */\r\n\r\n    initialData: {\r\n        status: '',\r\n        results: []\r\n    },\r\n\r\n    attributes: {\r\n        origins: {\r\n            type: [Array, String],\r\n            default: null\r\n        },\r\n\r\n        destinations: {\r\n            type: [Array, String],\r\n            default: null\r\n        },\r\n\r\n        'travel-mode': { // DRIVING, TRANSIT, WALKING, BICYCLING\r\n            type: String,\r\n            default: 'DRIVING'\r\n        },\r\n\r\n        units: { // METRIC, IMPERIAL\r\n            type: String,\r\n            default: 'METRIC'\r\n        },\r\n\r\n        'avoid-highways': {\r\n            type: Boolean,\r\n            default: false\r\n        },\r\n\r\n        'avoid-tolls': {\r\n            type: Boolean,\r\n            default: false\r\n        }\r\n    },\r\n\r\n    methods: {\r\n        getDistance: function(origin, destination) {\r\n            this.getDistance(origin, destination);\r\n        }\r\n    },\r\n\r\n    render: function(node) {\r\n        this.service = new google.maps.DistanceMatrixService();\r\n        this.update({});\r\n    },\r\n\r\n    update: function(props) {\r\n        if (this.props.origins != props.origins || this.props.destinations != props.destinations) {\r\n            this.getDistance(this.props.origins, this.props.destinations);\r\n        }\r\n    },\r\n\r\n    getDistance: function(origins, destinations) {\r\n        if (!(origins && destinations)) return;\r\n\r\n        if (typeof origins == 'string') {\r\n            origins = origins.split(/\\s*\\|\\/*/);\r\n        }\r\n\r\n        if (typeof destinations == 'string') {\r\n            destinations = destinations.split(/\\s*\\|\\/*/);\r\n        }\r\n\r\n        this.service.getDistanceMatrix({\r\n            origins: origins,\r\n            destinations: destinations,\r\n            travelMode: this.props['travel-mode'],\r\n            unitSystem: google.maps.UnitSystem[this.props.units],\r\n            avoidHighways: this.props['avoid-highways'],\r\n            avoidTolls: this.props['avoid-tolls']\r\n        }, this.onResponse.bind(this));\r\n    },\r\n\r\n    onResponse: function(response, status) {\r\n        this.set('status', status);\r\n\r\n        if (status == 'OK') {\r\n            var results = [];\r\n            var origins = response.originAddresses;\r\n            var destinations = response.destinationAddresses;\r\n\r\n            for (var i = 0; i < origins.length; i++) {\r\n                var elements = response.rows[i].elements;\r\n\r\n                for (var j = 0; j < elements.length; j++) {\r\n                    var element = elements[j];\r\n\r\n                    results.push({\r\n                        origin: origins[i],\r\n                        destination: destinations[j],\r\n                        distance: element.distance.text,\r\n                        duration: element.duration.text,\r\n                        meters: element.distance.value,\r\n                        seconds: element.duration.value\r\n                    });\r\n                }\r\n            }\r\n\r\n            this.set('results', results);\r\n        }\r\n    }\r\n\r\n});\r\n"]}